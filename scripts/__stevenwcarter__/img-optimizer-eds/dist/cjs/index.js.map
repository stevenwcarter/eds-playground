{"version":3,"file":"index.js","names":["pictures: PictureProps[]","i","pictures: HTMLPictureElement","a: HTMLSourceElement","b: HTMLSourceElement","source: HTMLSourceElement"],"sources":["../../src/index.ts"],"sourcesContent":["export interface Breakpoint {\n  media?: string;\n  width: number;\n}\nexport interface PictureProps {\n  src: string;\n  alt?: string;\n  eager?: boolean;\n  breakpoints?: Breakpoint[];\n}\nexport const createMultiOptimizedPicture = (\n  pictures: PictureProps[],\n): HTMLPictureElement | null => {\n  if (!pictures || pictures.length === 0) {\n    console.error('No pictures provided');\n    return null;\n  }\n  const pictureEl = document.createElement('picture');\n  pictures.forEach((picture, i) => {\n    const lastElement = i === pictures.length - 1;\n    const {\n      src,\n      alt = '',\n      eager = false,\n      breakpoints = [{ media: '(min-width: 600px)', width: 2000 }, { width: 750 }],\n    } = picture;\n\n    const url = new URL(src, window.location.href);\n    const { pathname } = url;\n    const ext = pathname.substring(pathname.lastIndexOf('.') + 1);\n\n    // webp\n    breakpoints.forEach((br) => {\n      const source = document.createElement('source');\n      if (br.media) source.setAttribute('media', br.media);\n      source.setAttribute('type', 'image/webp');\n      source.setAttribute('srcset', `${pathname}?width=${br.width}&format=webply&optimize=medium`);\n      pictureEl.appendChild(source);\n    });\n\n    // fallback\n    breakpoints.forEach((br, i) => {\n      if (i < breakpoints.length - 1) {\n        const source = document.createElement('source');\n        if (br.media) source.setAttribute('media', br.media);\n        source.setAttribute(\n          'srcset',\n          `${pathname}?width=${br.width}&format=${ext}&optimize=medium`,\n        );\n        pictureEl.appendChild(source);\n      } else if (lastElement) {\n        const img = document.createElement('img');\n        img.setAttribute('loading', eager ? 'eager' : 'lazy');\n        img.setAttribute('alt', alt);\n        pictureEl.appendChild(img);\n        img.setAttribute('src', `${pathname}?width=${br.width}&format=${ext}&optimize=medium`);\n      }\n    });\n  });\n  return sortPictureElement(pictureEl);\n};\n\nconst sortPictureElement = (pictures: HTMLPictureElement): HTMLPictureElement => {\n  const sources = Array.from(pictures.querySelectorAll('source'));\n  const img = pictures.querySelector('img');\n  sources.sort(breakpointSort);\n  pictures.innerHTML = '';\n  sources.forEach((source) => {\n    pictures.appendChild(source);\n  });\n  if (img) {\n    pictures.appendChild(img);\n  }\n  return pictures;\n};\n\nconst minWidthRegex = /.*min-width: *(\\d+)px/;\nconst breakpointSort = (a: HTMLSourceElement, b: HTMLSourceElement) => {\n  const a_width = parseMinWidth(a);\n  const b_width = parseMinWidth(b);\n\n  console.log(a_width, b_width);\n\n  return b_width - a_width;\n};\n\nconst parseMinWidth = (source: HTMLSourceElement): number => {\n  const media = source.getAttribute('media') || '';\n\n  return minWidthRegex.test(media) ? parseInt(minWidthRegex.exec(media)![1], 10) : 0;\n};\n"],"mappings":";;;AAAA,MAUa,8BAA8B,CACzCA,aAC8B;AAC9B,MAAK,YAAY,SAAS,WAAW,GAAG;AACtC,UAAQ,MAAM,uBAAuB;AACrC,SAAO;CACR;CACD,MAAM,YAAY,SAAS,cAAc,UAAU;AACnD,UAAS,QAAQ,CAAC,SAAS,MAAM;EAC/B,MAAM,cAAc,MAAM,SAAS,SAAS;EAC5C,MAAM,EACJ,KACA,MAAM,IACN,QAAQ,OACR,cAAc,CAAC;GAAE,OAAO;GAAsB,OAAO;EAAM,GAAE,EAAE,OAAO,IAAK,EAAC,EAC7E,GAAG;EAEJ,MAAM,MAAM,IAAI,IAAI,KAAK,OAAO,SAAS;EACzC,MAAM,EAAE,UAAU,GAAG;EACrB,MAAM,MAAM,SAAS,UAAU,SAAS,YAAY,IAAI,GAAG,EAAE;AAG7D,cAAY,QAAQ,CAAC,OAAO;GAC1B,MAAM,SAAS,SAAS,cAAc,SAAS;AAC/C,OAAI,GAAG,MAAO,QAAO,aAAa,SAAS,GAAG,MAAM;AACpD,UAAO,aAAa,QAAQ,aAAa;AACzC,UAAO,aAAa,WAAW,EAAE,SAAS,SAAS,GAAG,MAAM,gCAAgC;AAC5F,aAAU,YAAY,OAAO;EAC9B,EAAC;AAGF,cAAY,QAAQ,CAAC,IAAIC,QAAM;AAC7B,OAAIA,MAAI,YAAY,SAAS,GAAG;IAC9B,MAAM,SAAS,SAAS,cAAc,SAAS;AAC/C,QAAI,GAAG,MAAO,QAAO,aAAa,SAAS,GAAG,MAAM;AACpD,WAAO,aACL,WACC,EAAE,SAAS,SAAS,GAAG,MAAM,UAAU,IAAI,kBAC7C;AACD,cAAU,YAAY,OAAO;GAC9B,WAAU,aAAa;IACtB,MAAM,MAAM,SAAS,cAAc,MAAM;AACzC,QAAI,aAAa,WAAW,QAAQ,UAAU,OAAO;AACrD,QAAI,aAAa,OAAO,IAAI;AAC5B,cAAU,YAAY,IAAI;AAC1B,QAAI,aAAa,QAAQ,EAAE,SAAS,SAAS,GAAG,MAAM,UAAU,IAAI,kBAAkB;GACvF;EACF,EAAC;CACH,EAAC;AACF,QAAO,mBAAmB,UAAU;AACrC;AAED,MAAM,qBAAqB,CAACC,aAAqD;CAC/E,MAAM,UAAU,MAAM,KAAK,SAAS,iBAAiB,SAAS,CAAC;CAC/D,MAAM,MAAM,SAAS,cAAc,MAAM;AACzC,SAAQ,KAAK,eAAe;AAC5B,UAAS,YAAY;AACrB,SAAQ,QAAQ,CAAC,WAAW;AAC1B,WAAS,YAAY,OAAO;CAC7B,EAAC;AACF,KAAI,KAAK;AACP,WAAS,YAAY,IAAI;CAC1B;AACD,QAAO;AACR;AAED,MAAM,gBAAgB;AACtB,MAAM,iBAAiB,CAACC,GAAsBC,MAAyB;CACrE,MAAM,UAAU,cAAc,EAAE;CAChC,MAAM,UAAU,cAAc,EAAE;AAEhC,SAAQ,IAAI,SAAS,QAAQ;AAE7B,QAAO,UAAU;AAClB;AAED,MAAM,gBAAgB,CAACC,WAAsC;CAC3D,MAAM,QAAQ,OAAO,aAAa,QAAQ,IAAI;AAE9C,QAAO,cAAc,KAAK,MAAM,GAAG,SAAS,cAAc,KAAK,MAAM,CAAE,IAAI,GAAG,GAAG;AAClF"}